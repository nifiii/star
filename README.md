# ğŸ¸ ç¾½æ¯›çƒæœªæ¥ä¹‹æ˜Ÿ - æ•°æ®åŠ©æ‰‹ (HuaTiHui Data Insight)

**å…³æ³¨é’å°‘å¹´æˆé•¿ï¼Œç”¨æ•°æ®è®°å½•æ¯ä¸€æ»´æ±—æ°´ã€‚**

è¿™æ˜¯ä¸€ä¸ªåŸºäº React + Vite æ„å»ºçš„ç°ä»£åŒ–æ•°æ®ä»ªè¡¨ç›˜ï¼Œä¸“ä¸ºå®¶é•¿å’Œæ•™ç»ƒè®¾è®¡ã€‚å®ƒèƒ½å¤Ÿä»åä½“æ±‡å¹³å°è·å–å…¬å¼€çš„ç¾½æ¯›çƒèµ›äº‹æ•°æ®ï¼Œç”Ÿæˆç§¯åˆ†æ’åï¼Œè¿½è¸ªå°é€‰æ‰‹çš„å†å²æˆ˜ç»©ï¼Œå¹¶åˆ©ç”¨ **Google Gemini AI** æä¾›æ™ºèƒ½çš„æˆ˜æœ¯åˆ†æå’Œå»ºè®®ã€‚

![Dashboard Preview](https://via.placeholder.com/800x450.png?text=Dashboard+Preview)

## âœ¨ æ ¸å¿ƒäº®ç‚¹

### ğŸš€ æé€Ÿä½“éªŒ (Performance)
*   **åŒé‡å¢é‡å¼•æ“**: é‡‡ç”¨ **Server-Side Incremental Scraper** æŠ€æœ¯ã€‚åå°è„šæœ¬æ™ºèƒ½åˆ†ç¦»â€œèµ›äº‹æ’åâ€ä¸â€œæ¯”èµ›æ¯”åˆ†â€çš„æŠ“å–é€»è¾‘ï¼Œç¡®ä¿æ•°æ®å®Œæ•´æ€§ã€‚
*   **é™æ€åŒ–æŒä¹…å­˜å‚¨**: è‡ªåŠ¨ç”Ÿæˆ `daily_rankings.json` (æ¦œå•) å’Œ `daily_matches.json` (æ¯”åˆ†åº“)ã€‚å‰ç«¯ä¼˜å…ˆè¯»å–è¿™äº›é™æ€èµ„æºï¼Œé…åˆ Nginx ç¼“å­˜ï¼Œå®ç°ç§’çº§åŠ è½½ï¼Œå¤§å¹…é™ä½ API ä¾èµ–ã€‚

### ğŸ›¡ï¸ ç½‘ç»œä¼˜åŒ– (AI Proxy)
*   **Nginx åå‘ä»£ç†**: å†…ç½® `/google-ai/` è½¬å‘è§„åˆ™ï¼Œå°†å‰ç«¯çš„ AI è¯·æ±‚é€šè¿‡æœåŠ¡å™¨ä¸­è½¬è‡³ Googleã€‚
*   **æ— éšœç¢è®¿é—®**: å³ä½¿å®¢æˆ·ç«¯æ— æ³•ç›´æ¥è¿æ¥ Google API (å¦‚å›½å†…ç½‘ç»œç¯å¢ƒ)ï¼Œä¹Ÿèƒ½æ­£å¸¸ä½¿ç”¨ AI æˆ˜æœ¯åˆ†æåŠŸèƒ½ã€‚

### ğŸ§  åŠŸèƒ½ç‰¹æ€§
*   **ğŸ† ç§¯åˆ†æ’è¡Œæ¦œ**: èšåˆè®¡ç®—æŒ‡å®šåŸå¸‚ã€å¹´é¾„æ®µï¼ˆå¦‚ U8ã€U9ï¼‰çš„æ‰€æœ‰è¿‘æœŸèµ›äº‹ç§¯åˆ†ã€‚
*   **ğŸ‘¤ é€‰æ‰‹ç”Ÿæ¶¯æ¡£æ¡ˆ**: å…¨ç½‘æœç´¢é€‰æ‰‹çš„å‚èµ›å†å²ï¼Œç”Ÿæˆèƒœç‡æ›²çº¿å’Œå¯¹æ‰‹åˆ†æã€‚æ”¯æŒä»æœ¬åœ°æ¯”åˆ†åº“å¿«é€Ÿå›æº¯ã€‚
*   **ğŸ¤– AI æ•™ç»ƒ**: 
    *   **èµ›åŒºè§‚å¯Ÿ**: åˆ†æèµ›åŒºç«äº‰æ ¼å±€ï¼Œå‘ç°æ½œåŠ›æ–°æ˜Ÿã€‚
    *   **æˆ˜æœ¯æŠ¥å‘Š**: é’ˆå¯¹ä¸ªäººå†å²æˆ˜ç»©ï¼Œè¯„ä¼°ç¨³å®šæ€§å¹¶ç»™å‡ºè®­ç»ƒå»ºè®®ã€‚
*   **ğŸ“Š æ•°æ®å¯¼å‡º**: æ”¯æŒ Excel æ ¼å¼å¯¼å‡ºã€‚

## ğŸ’¾ æ•°æ®å­˜å‚¨ä¸æŸ¥è¯¢æœºåˆ¶ (Data Architecture)

æœ¬é¡¹ç›®é‡‡ç”¨ **"é™æ€ç¦»çº¿åº“ + å®æ—¶ API å…œåº•"** çš„æ··åˆæ¶æ„ï¼Œå®ç°äº†é«˜æ€§èƒ½ä¸æ•°æ®å®Œæ•´æ€§çš„å¹³è¡¡ã€‚

### 1. æ•°æ®æŒä¹…åŒ– (Storage)
æ ¸å¿ƒæ•°æ®å­˜å‚¨ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„ JSON æ–‡ä»¶ï¼Œç”±åå°è„šæœ¬è‡ªåŠ¨ç»´æŠ¤å¹¶ç”Ÿæˆåˆ°é™æ€èµ„æºç›®å½•ï¼š

*   **`daily_rankings.json` (æ¦œå•åº“)**:
    *   **å†…å®¹**: åŒ…å«æ¯ä¸€åœºèµ›äº‹çš„è¯¦ç»†æ’åä¿¡æ¯ï¼ˆç¬¬1ååˆ°ç¬¬Nåï¼‰ã€‚
    *   **ç»“æ„**: `[{ raceId, game_name, playerName, rank, score, club... }]`
    *   **ç”¨é€”**: ç”¨äºå¿«é€Ÿç”Ÿæˆâ€œç§¯åˆ†é¾™è™æ¦œâ€å’Œèµ›åŒºåˆ†æã€‚
*   **`daily_matches.json` (æ¯”åˆ†åº“)**:
    *   **å†…å®¹**: åŒ…å«æ¯ä¸€åœºå•é¡¹å¯¹å†³çš„æ¯”åˆ†è¯¦æƒ…ã€‚
    *   **ç»“æ„**: `[{ raceId, matchId, playerA, playerB, score: "21:15", round... }]`
    *   **ç”¨é€”**: ç”¨äºâ€œé€‰æ‰‹ç”Ÿæ¶¯æ¡£æ¡ˆâ€æŸ¥è¯¢ï¼Œæ”¯æŒç§’çº§æ£€ç´¢å†å²æˆ˜ç»©ã€‚

### 2. å¢é‡æ›´æ–°é€»è¾‘ (Incremental Updates)
åå°è„šæœ¬ (`scripts/getToken.js`) è¿è¡Œåœ¨ Docker å®¹å™¨ä¸­ï¼Œæ‰§è¡Œé€»è¾‘å¦‚ä¸‹ï¼š

1.  **è°ƒåº¦**: æ¯å¤©å‡Œæ™¨ 5:00 (åŒ—äº¬æ—¶é—´) è‡ªåŠ¨å”¤é†’ã€‚
2.  **è·å–ç›®å½•**: æ‹‰å–å¹¿å·å¸‚æœ€è¿‘ä¸€å¹´å·²ç»“æŸçš„èµ›äº‹åˆ—è¡¨ã€‚
3.  **åŒé‡æ¯”å¯¹**:
    *   æ£€æŸ¥ `daily_rankings.json` æ˜¯å¦åŒ…å«è¯¥èµ›äº‹ IDã€‚
    *   æ£€æŸ¥ `daily_matches.json` æ˜¯å¦åŒ…å«è¯¥èµ›äº‹ IDã€‚
4.  **æŒ‰éœ€æŠ“å– (Delta Fetch)**:
    *   å¦‚æœæŸåœºæ¯”èµ›åªæœ‰æ’åä½†æ²¡æœ‰æ¯”åˆ†ï¼ˆä¾‹å¦‚æ—§é€»è¾‘é—ç•™çš„æ•°æ®ï¼‰ï¼Œè„šæœ¬ä¼š**åªæŠ“å–ç¼ºå¤±çš„æ¯”åˆ†æ•°æ®**å¹¶è¿½åŠ åˆ°æ–‡ä»¶ã€‚
    *   åªæœ‰å½“æœ¬åœ°å®Œå…¨ç¼ºå¤±è¯¥ ID æ—¶ï¼Œæ‰å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚
5.  **åŸå­å†™å…¥**: æ›´æ–°å®Œæˆåï¼Œå°†å®Œæ•´æ•°æ®å†™å›ç£ç›˜ï¼Œä¾› Nginx è¯»å–ã€‚

### 3. å‰ç«¯æŸ¥è¯¢ç­–ç•¥ (Query Logic)
å‰ç«¯ (`huaTiHuiService.ts`) é‡‡ç”¨ **Cache-First** ç­–ç•¥ï¼š

1.  **æŸ¥æ¦œå•**: 
    *   å‰ç«¯è¯·æ±‚ `/daily_rankings.json`ã€‚
    *   ä¸‹è½½æˆåŠŸåï¼Œåˆ©ç”¨æµè§ˆå™¨å†…å­˜æ ¹æ®ç”¨æˆ·é€‰æ‹©çš„ **å¹´é¾„/ç»„åˆ«/é¡¹ç›®** è¿›è¡Œå®æ—¶è¿‡æ»¤ã€‚
    *   *ä¼˜åŠ¿*: å³ä½¿æ•°æ®é‡å¤§ï¼Œæœ¬åœ° JS å¤„ç†ä¹Ÿæ¯”ç½‘ç»œè¯·æ±‚å¿«å¾—å¤šã€‚
2.  **æŸ¥é€‰æ‰‹**: 
    *   å‰ç«¯è¯·æ±‚ `/daily_matches.json`ã€‚
    *   åœ¨æ•°ä¸‡æ¡è®°å½•ä¸­éå†æœç´¢ `playerName`ã€‚
    *   *ä¼˜åŠ¿*: å®ç°â€œç§’æŸ¥â€å†å²æˆ˜ç»©ï¼Œæ— éœ€ç­‰å¾…å‡ åä¸ª API ä¸²è¡Œè¿”å›ã€‚
3.  **Live Fallback (ç¾å¤‡)**: 
    *   åªæœ‰å½“ JSON æ–‡ä»¶ä¸‹è½½å¤±è´¥ï¼ˆ404/500ï¼‰æˆ–å†…å®¹ä¸ºç©ºæ—¶ï¼Œç³»ç»Ÿæ‰ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸ºâ€œå®æ—¶çˆ¬è™«æ¨¡å¼â€ï¼Œé€šè¿‡æµè§ˆå™¨ç›´æ¥è¯·æ±‚åä½“æ±‡ APIã€‚

---

## ğŸ› ï¸ æŠ€æœ¯æ¶æ„

*   **å‰ç«¯**: React 19, Vite, Tailwind CSS
*   **åç«¯**: Node.js (æ— éœ€ Puppeteerï¼Œçº¯ API è°ƒç”¨), `node-cron` è°ƒåº¦é€»è¾‘
*   **æ•°æ®æµ**: å®šæ—¶ä»»åŠ¡ -> API -> JSON Files -> Nginx -> React Client
*   **AI**: Google Gemini API (`@google/genai`) + **Nginx Proxy** (è§£å†³ç½‘ç»œè¿é€šæ€§)
*   **éƒ¨ç½²**: Docker (Nginx + Node.js æ··åˆé•œåƒ)

---

## ğŸš€ éƒ¨ç½²æŒ‡å— (Production Deployment)

æœ¬é¡¹ç›®çš„ Docker é•œåƒé‡‡ç”¨ **All-in-One** è®¾è®¡ï¼šåŒä¸€ä¸ªå®¹å™¨å†…è¿è¡Œ Nginxï¼ˆæä¾›é«˜æ€§èƒ½ Web æœåŠ¡ï¼‰å’Œ Node.js åå°è¿›ç¨‹ï¼ˆè´Ÿè´£ Token ä¿æ´»å’Œæ•°æ®æ›´æ–°ï¼‰ã€‚

### 1. å‡†å¤‡ç¯å¢ƒ
*   Linux æœåŠ¡å™¨ (Ubuntu/Debian/CentOS) - **éœ€å¯è®¿é—® Google API**
*   Docker ç¯å¢ƒ
*   åä½“æ±‡è´¦å·/å¯†ç  (ç”¨äºåå°è„šæœ¬è·å–æ•°æ®)
*   Google Gemini API Key (ç”¨äº AI åˆ†æ)

### 2. è·å–ä»£ç 
```bash
git clone <your-repo-url>
cd huatihui-data-insight
```

### 3. æ„å»ºé•œåƒ
æ„å»ºæ—¶éœ€æ³¨å…¥ API Keyï¼ˆVite æ„å»ºæ—¶éœ€è¦ï¼‰ï¼š

```bash
docker build \
  --build-arg API_KEY="your_gemini_api_key_here" \
  -t hth-dashboard \
  -f Dockerfile.txt .
```

### 4. è¿è¡Œå®¹å™¨
å¯åŠ¨æ—¶æ³¨å…¥åä½“æ±‡å‡­è¯ã€‚åå°è„šæœ¬ä¼šè‡ªåŠ¨ç™»å½•å¹¶å¼€å§‹æ‰§è¡Œæ¯æ—¥å‡Œæ™¨çš„å¢é‡æ›´æ–°ä»»åŠ¡ã€‚

```bash
docker run -d \
  --name my-hth-dashboard \
  --restart always \
  -p 80:80 \
  -e HTH_USER="13800138000" \
  -e HTH_PASS="YourPassword123" \
  -e TZ="Asia/Shanghai" \
  hth-dashboard
```

*   `-e TZ="Asia/Shanghai"`: è®¾ç½®æ—¶åŒºï¼Œç¡®ä¿å®šæ—¶ä»»åŠ¡åœ¨æ­£ç¡®çš„åŒ—äº¬æ—¶é—´å‡Œæ™¨ 5 ç‚¹è¿è¡Œã€‚

### 5. éªŒè¯ä¸ç»´æŠ¤

**æŸ¥çœ‹åå°çˆ¬è™«æ—¥å¿—ï¼š**
```bash
docker logs -f my-hth-dashboard
```
ä½ åº”è¯¥èƒ½çœ‹åˆ° `ğŸš€ å¼€å§‹æ‰§è¡Œæ¯æ—¥æ•°æ®æ›´æ–°...` æˆ– `â° å®šæ—¶å™¨å·²è®¾å®š` ç­‰æ—¥å¿—ã€‚

**æ‰‹åŠ¨è§¦å‘æ›´æ–°ï¼ˆå¯é€‰ï¼‰ï¼š**
å¦‚æœä¸æƒ³ç­‰è‡ªåŠ¨è°ƒåº¦ï¼Œå¯ä»¥è¿›å…¥å®¹å™¨æ‰‹åŠ¨è¿è¡Œï¼š
```bash
docker exec -it my-hth-dashboard npm run get-token
```

---

## ğŸ’» æœ¬åœ°å¼€å‘

1.  **å®‰è£…ä¾èµ–**: `npm install`
2.  **è·å– Token**: è¿è¡Œ `npm run get-token` (è¿™ä¼šå¯åŠ¨åå°è„šæœ¬ï¼Œæ‰§è¡Œå¢é‡æ›´æ–°å¹¶ç”Ÿæˆ JSON æ–‡ä»¶)ã€‚
3.  **å¯åŠ¨å‰ç«¯**: `npm run dev`

## ğŸ“„ License
MIT